<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      async function load() {
      let email = sessionStorage.getItem("email") || localStorage.getItem("email");
      let pass = sessionStorage.getItem("pass") || localStorage.getItem("pass");
      let res = await fetch('/user/auth',{
          method:'POST',
          headers:{
              'content-type':'application/json'
          },
          body:JSON.stringify({
              email,pass
          })
      }).then(res=>res.json());
      document.querySelector(".welcome-text").textContent +=` ${res.name}`
      if (!(res.authenticated)) {
        return window.location.assign("/login");
      }
      if(res.shop){
        console.log(res.shop);
          window.location.assign('/user/dashboard')
      }
    }
    load();
    </script>
      <script
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcjOCY2sK1-HXkxsQUqISRRYqF9p9Ul8U&callback=initMap"
    ></script>
      <link rel="stylesheet" href="/style.css">
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nearMed | eShop Establishment</title>
  </head>
  <body>
    <div class="container">
      <header class="header-section">
        <div class="logo">
            <svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="297mm"
   height="75mm"
   viewBox="0 0 297 75"
   version="1.1"
   id="svg8"
   inkscape:version="1.0.2-2 (e86c870879, 2021-01-15)"
   sodipodi:docname="logo_nearMed.svg">
  <defs
     id="defs2">
    <rect
       x="51.404762"
       y="82.398811"
       width="69.547623"
       height="18.898809"
       id="rect835" />
    <rect
       x="51.404762"
       y="82.398811"
       width="69.547623"
       height="18.898809"
       id="rect835-2" />
    <rect
       x="51.404762"
       y="82.398811"
       width="69.547623"
       height="18.898809"
       id="rect865" />
  </defs>
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="0.35"
     inkscape:cx="155.43878"
     inkscape:cy="144.75411"
     inkscape:document-units="mm"
     inkscape:current-layer="text833-0"
     inkscape:document-rotation="0"
     showgrid="false"
     showguides="true"
     inkscape:guide-bbox="true"
     inkscape:window-width="1920"
     inkscape:window-height="991"
     inkscape:window-x="-9"
     inkscape:window-y="-9"
     inkscape:window-maximized="1"
     height="100mm" />
  <metadata
     id="metadata5">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title />
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1">
    <g
       aria-label="nearMed"
       transform="matrix(5.1441845,0,0,5.1441845,-209.89532,-417.19756)"
       id="text833-0"
       style="font-style:normal;font-weight:normal;font-size:10.5833px;line-height:1.25;font-family:sans-serif;white-space:pre;shape-inside:url(#rect835-2);fill:#2e2e2e;fill-opacity:1;stroke:none">
      <path
         d="m 53.552707,89.148102 v 2.614075 h -1.471079 v -4.942401 h 1.471079 v 0.719665 q 0.201082,-0.370416 0.592664,-0.592665 0.402166,-0.232833 0.836081,-0.232833 0.867831,0 1.333496,0.539749 0.476248,0.529165 0.476248,1.555745 v 2.95274 h -1.471078 v -2.635241 q 0,-0.465666 -0.232833,-0.719665 -0.232832,-0.264582 -0.624415,-0.264582 -0.910163,0 -0.910163,1.005413 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'Sofia Pro';-inkscape-font-specification:'Sofia Pro';fill:#2e2e2e;fill-opacity:1"
         id="path867" />
      <path
         d="m 61.564253,90.132349 1.068913,0.730248 q -0.687914,1.005413 -2.254243,1.005413 -1.09008,0 -1.841494,-0.719664 -0.740831,-0.730248 -0.740831,-1.873244 0,-1.142997 0.740831,-1.852078 0.740831,-0.709081 1.841494,-0.709081 1.079497,0 1.799161,0.730248 0.730248,0.719664 0.730248,1.873244 0,0.116416 -0.02117,0.455082 h -3.619488 q 0.05292,0.391582 0.402165,0.613831 0.349249,0.211666 0.814914,0.211666 0.709081,0 1.079497,-0.465665 z m -2.27541,-1.280579 h 2.137827 q -0.05292,-0.402166 -0.370416,-0.624415 -0.306915,-0.222249 -0.666747,-0.222249 -0.359833,-0.01058 -0.687915,0.222249 -0.328082,0.222249 -0.412749,0.624415 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'Sofia Pro';-inkscape-font-specification:'Sofia Pro';fill:#2e2e2e;fill-opacity:1"
         id="path869" />
      <path
         d="m 69.036055,91.762177 h -1.460496 v -0.560915 q -0.201083,0.306916 -0.656164,0.486832 -0.412749,0.169333 -0.783165,0.169333 -1.005413,0 -1.756827,-0.709081 -0.761998,-0.709081 -0.761998,-1.862661 0,-1.142996 0.761998,-1.852077 0.772581,-0.719665 1.756827,-0.719665 0.391583,0 0.793748,0.169333 0.412749,0.15875 0.645581,0.486832 v -0.550332 h 1.460496 z m -2.656409,-1.301746 q 0.486832,0 0.836081,-0.328082 0.359832,-0.328082 0.359832,-0.846664 0,-0.518582 -0.359832,-0.846664 -0.349249,-0.328082 -0.836081,-0.328082 -0.476248,0 -0.86783,0.338665 -0.370416,0.338666 -0.370416,0.836081 0,0.507998 0.370416,0.846664 0.370415,0.328082 0.86783,0.328082 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'Sofia Pro';-inkscape-font-specification:'Sofia Pro';fill:#2e2e2e;fill-opacity:1"
         id="path871" />
      <path
         d="m 71.861789,90.037099 v 1.725078 H 70.39071 v -4.942401 h 1.471079 v 1.195913 q 0.179916,-0.613831 0.560915,-0.952497 0.391582,-0.349249 0.83608,-0.349249 0.465665,0 0.846664,0.179916 l -0.264582,1.322913 q -0.317499,-0.148166 -0.751415,-0.148166 -1.227662,0 -1.227662,1.968493 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'Sofia Pro';-inkscape-font-specification:'Sofia Pro';fill:#2e2e2e;fill-opacity:1"
         id="path873" />
      <path
         d="m 76.677154,84.470284 2.201326,4.698985 2.18016,-4.698985 h 1.301746 l 0.888997,7.291893 h -1.555745 l -0.507999,-4.370903 -1.703911,3.534823 h -1.195913 l -1.714494,-3.534823 -0.518582,4.370903 h -1.555745 l 0.89958,-7.291893 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'Sofia Pro';-inkscape-font-specification:'Sofia Pro';fill:#2e2e2e;fill-opacity:1"
         id="path875" />
      <path
         d="m 87.778998,90.132349 1.068913,0.730248 q -0.687914,1.005413 -2.254243,1.005413 -1.09008,0 -1.841494,-0.719664 -0.740831,-0.730248 -0.740831,-1.873244 0,-1.142997 0.740831,-1.852078 0.740831,-0.709081 1.841494,-0.709081 1.079497,0 1.799161,0.730248 0.730248,0.719664 0.730248,1.873244 0,0.116416 -0.02117,0.455082 h -3.619488 q 0.05292,0.391582 0.402165,0.613831 0.349249,0.211666 0.814914,0.211666 0.709081,0 1.079497,-0.465665 z m -2.27541,-1.280579 h 2.137827 q -0.05292,-0.402166 -0.370416,-0.624415 -0.306915,-0.222249 -0.666747,-0.222249 -0.359833,-0.01058 -0.687915,0.222249 -0.328082,0.222249 -0.412749,0.624415 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'Sofia Pro';-inkscape-font-specification:'Sofia Pro';fill:#2e2e2e;fill-opacity:1"
         id="path877" />
      <path
         d="m 93.652719,89.275102 q 0,-0.529165 -0.328082,-0.846664 -0.328083,-0.328082 -0.814914,-0.328082 -0.486832,0 -0.814914,0.338665 -0.328083,0.328082 -0.328083,0.836081 0,0.529165 0.328083,0.86783 0.328082,0.328083 0.814914,0.328083 0.476248,0 0.80433,-0.338666 0.338666,-0.349249 0.338666,-0.857247 z m 1.492245,-5.143484 v 7.630559 h -1.460495 v -0.613831 q -0.179916,0.338665 -0.571498,0.529165 -0.391582,0.190499 -0.878414,0.190499 -0.984247,0 -1.693328,-0.709081 -0.698498,-0.719664 -0.698498,-1.852077 0,-1.164163 0.698498,-1.873244 0.719664,-0.719665 1.693328,-0.719665 0.476248,0 0.86783,0.1905 0.402166,0.190499 0.582082,0.518581 v -3.291406 z"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'Sofia Pro';-inkscape-font-specification:'Sofia Pro';fill:#2e2e2e;fill-opacity:1"
         id="path879" />
    </g>
    <g
       fill="#15cb70"
       id="g843-0"
       transform="matrix(0.10262551,0,0,0.10262551,2.3950039,11.78963)">
      <path
         d="M 256,0 C 139.167,0 44.467,94.708 44.467,211.533 44.467,372.184 256,512 256,512 256,512 467.533,372.184 467.533,211.533 467.533,94.708 372.833,0 256,0 Z m 0,375.941 c -90.8,0 -164.4,-73.6 -164.4,-164.408 0,-90.8 73.601,-164.408 164.4,-164.408 90.799,0 164.417,73.608 164.417,164.408 0,90.809 -73.617,164.408 -164.417,164.408 z"
         id="path839-3" />
      <path
         d="M 279.35,131.417 171.583,239.184 c -17.283,17.283 -17.283,45.3 0,62.583 17.275,17.267 45.292,17.267 62.575,0 L 341.925,193.984 c 17.283,-17.267 17.283,-45.283 0,-62.566 -17.276,-17.285 -45.291,-17.285 -62.575,-0.001 z m 48.674,48.666 -53.891,53.883 -34.767,-34.766 53.893,-53.884 c 9.583,-9.583 25.174,-9.583 34.766,0 9.583,9.584 9.583,25.184 -10e-4,34.767 z"
         id="path841-2" />
    </g>
    <circle
       style="fill:#15cb70;fill-opacity:1;stroke-width:2.8888"
       id="path908"
       cx="285.73187"
       cy="51.738644"
       r="3.7266104" />
  </g>
</svg>

        </div>
        <div class="nav"><a href="/login" id="logout" class="nav-link">Log Out</a></div>
      </header>
        <main class="main-section center">
            <div class="map-section">
                <div id="map"></div>
    <script>
      function initMap() {
  const myLatlng = { lat: 28.640552786049202, lng: 77.22074051949213 };
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 4,
    center: myLatlng,
    mapId:'7bd8fe8d2cca9c09'
  });
  // Create the initial InfoWindow.
  let infoWindow = new google.maps.InfoWindow({
    content: "Click the map to set your shop's location.",
    position: myLatlng,
  });

  infoWindow.open(map);
  // Configure the click listener.
  map.addListener("click", (mapsMouseEvent) => {
    // Close the current InfoWindow.
    infoWindow.close();
    // Create a new InfoWindow.
    infoWindow = new google.maps.InfoWindow({
      position: mapsMouseEvent.latLng,
    });
    infoWindow.setContent(
      JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
    );
    const coord = JSON.stringify(mapsMouseEvent.latLng.toJSON());
    document.getElementById('coord').value=coord;
    infoWindow.open(map);
  });
}

window.initMap = initMap;
    </script>
            </div>
            <div class="login-form">
                <div class="welcome-section">
                    <span class="welcome-text">Hi,</span>
                    <p class="welcome-subtext">You are just one step away to be the part of this journey. Please setup your eShop by giving following details.</p>
                </div>
                <form id="submit-form">
                    <input type="hidden" id="coord">
                    <div class="form-group">
                        <div class="field-group">
                            <div class="icon"><svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></div>
                            <div class="input-field">
                                <input autocomplete="off" type="text" placeholder="Shop Name" name="sname" id="sname">
                                <label for="sname">Shop Name</label>
                            </div>
                        </div>
                        <div class="field-group">
                            <div class="icon"><svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>
                            <div class="input-field">
                                <input autocomplete="off" type="text" placeholder="City" name="city" id="city">
                                <label for="city">City</label>
                            </div>
                        </div>
                        <div class="field-group">
                            <div class="icon"><svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></div>
                            <div class="input-field">
                                <input autocomplete="off" type="text" placeholder="District" name="dist" id="dist">
                                <label for="dist">District</label>
                            </div>
                        </div>
                        <div class="field-group">
                            <div class="icon"><svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>
                            <div class="input-field">
                                <input autocomplete="off" type="text" placeholder="State" name="state" id="state">
                                <label for="state">State</label>
                            </div>
                        </div>
                        <div class="field-group">
                            <div class="icon"><svg class="icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>
                            <div class="input-field">
                                <input autocomplete="off" type="number" placeholder="Pin Code" name="pin" id="pin">
                                <label for="pin">Pin Code</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-btn-group">
                        <button class="primary-btn">SUBMIT</button>
                        <a href="/register" class="secondary-btn">Reset</a>
                    </div>
                </form>
            </div>
    </div>
    <script>
        let form = document.getElementById('submit-form');
        form.addEventListener('submit',async function(e){
            e.preventDefault();
            let email = sessionStorage.getItem('email') || localStorage.getItem('email')
            let password = sessionStorage.getItem('pass') || localStorage.getItem('pass')
            let name =document.getElementById('sname').value;
            let city =document.getElementById('city').value;
            let dist =document.getElementById('dist').value;
            let state =document.getElementById('state').value;
            let pin =document.getElementById('pin').value;
            let coord =document.getElementById('coord').value;
            let res = await fetch('/user/shop',{
                method:'POST',
            headers:{
                'content-type':'application/json'
            },
            body:JSON.stringify({name,city,dist,state,pin,coord,email,password})
            }).then(res=>res.json());
            if(res.status==='ok'){
              console.log(res);
            window.location.assign('/user/dashboard')
          }
        })
        
    let logOut = document.getElementById("logout");
    logOut.addEventListener("click", function (e) {
      localStorage.clear();
      sessionStorage.clear();
    });
    </script>
  </body>
</html>
